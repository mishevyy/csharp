# Структуры

Структуры являются типами значений, и могут содержать конструкторы, константы, поля, свойства, методы, индексаторы, операторы, события и вложенные типы так же могут содержать статические члены

В структурах нельзя инициализировать поля непосредственно в месте их создания

Переменные структуры хранят не ссылку на объект, а сам объект. То есть это значимый тип, а не ссылочный. Значит если одной структуре присвоить другую, то Скопируются Все Поля одной структуры в другую, а не ссылка, как было бы с классами.
Так как переменная хранит сами данные, а не ссылку на них, то доступ к полям осуществляется быстрее и есть некоторая экономия памяти.

Как правило, типы структуры используются для проектирования небольших ориентированных на данные типов, которые предоставляют минимум поведения или не предоставляют его вовсе

## Структуры и наследование

От структур нельзя наследоваться. Наследование структур разрешено только от интерфейсов. Все структуры неявно наследуются от абстрактного класса - ValueType
Структуры могут храниться как в стеке так и на куче (ссылочные объекты могут хранится только на куче), в зависимости от места создания, если структура создается в локальной области или методе, она помещается в стек, если структура существует в ссылочном типе, она будет размещена в куче.

```c#
struct MyStruct
{
    public string Name { get; set; }
    public int Field { get; set; }
    private int a;

    public static int staticMember;

    // Структуры не могут содержать явных конструкторов по умолчанию
    // public MyStruct() { }

    // Статический конструктор вызывается в связке с пользовательсяким, и всегда отрабатывает первым
    static MyStruct()
    {
        staticMember = 0;
        Console.WriteLine("Hello from static .ctor");
    }

    // Если в структуре используется пользовательский конструктор, то требуется инициализация всех полей
    public MyStruct(string name, int field)
    {
        a = default;
        Name = name;
        Field = field;
    }
}
```

## Упаковка и распаковка

Упаковка (Boxing) - преобразование структурного типа (типа значения) в ссылочный тип (Object или любой другой тип интерфейса, реализуемый этим типом значения). Когда тип значения упаковывается средой CLR, она создает программу-оболочку значения внутри System.Object и сохраняет ее в управляемой куче.

Распаковка (Unboxing) - преобразование ссылочного типа в структурный тип. Операция распаковки-преобразования извлекает тип значения из объекта. Перед распаковкой среда выполнения проверяет совместимость между объектом и структурой, в которую будет происходить распаковка.

```c#
interface IInterface
{
    void Method();
}

struct MyStruct : IInterface
{
    public void Method()
    {
        Console.WriteLine("Method");
    }
}    

short a = 25;
object o = a;  // Упаковка переменной - а  (Boxing).            
short b = (short)o; // Распаковка объекта (UnBoxing).
```

_Распаковка должна производиться только в тот тип, из которого производилась упаковка._

```c#
byte s = (byte)o;
```

```c#
MyStruct my;
my.Method();
// Упаковка (Boxing).
IInterface boxed = my;
boxed.Method();
// Распаковка объекта (UnBoxing).
MyStruct unBoxed = (MyStruct)boxed;
```

```c#
MyStruct myStruct = new MyStruct();
// Упаковка (Boxing).
ValueType boxedS = myStruct;
// Распаковка объекта (UnBoxing).
MyStruct unBoxedS = (MyStruct)boxed;
```
